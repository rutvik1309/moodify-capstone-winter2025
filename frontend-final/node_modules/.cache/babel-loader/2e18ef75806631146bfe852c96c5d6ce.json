{"ast":null,"code":"/* // src/components/Callback.js\nimport React, { useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\n\nconst Callback = () => {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const code = urlParams.get(\"code\");\n    const codeVerifier = localStorage.getItem(\"code_verifier\");\n\n    if (!code || !codeVerifier) {\n      alert(\"Missing authorization code or verifier. Please try logging in again.\");\n      return navigate(\"/\");\n    }\n\n    const exchangeToken = async () => {\n      try {\n        // Step 1: Exchange code + verifier for access token\n        const exchangeRes = await axios.post(\"https://moodify-i9qm.onrender.com/api/auth/exchange-token\", {\n          code,\n          code_verifier: codeVerifier\n        });\n\n        const { access_token, refresh_token } = exchangeRes.data;\nlocalStorage.setItem(\"spotify_token\", access_token);\nlocalStorage.setItem(\"spotify_refresh_token\", refresh_token);\nconst expiresIn = exchangeRes.data.expires_in; // seconds\nconst expiresAt = Date.now() + expiresIn * 1000; // milliseconds\nlocalStorage.setItem(\"spotify_token_expires_at\", expiresAt.toString());\n\n\n        console.log(\"✅ Spotify Access Token:\", access_token);\n\n\n        // Step 2: Get user profile from Spotify\n        const profileRes = await fetch(\"https://api.spotify.com/v1/me\", {\n          headers: {\n            Authorization: `Bearer ${access_token}`,\n          },\n        });\n\n        const profile = await profileRes.json();\n        const { email, display_name, id: spotifyUserId } = profile;\n        localStorage.setItem(\"spotify_user_id\", spotifyUserId);\n\n        // Step 3: Log in/register in Moodify backend\n        const moodifyRes = await axios.post(\"https://moodify-i9qm.onrender.com/api/auth/spotify-login\", {\n          email,\n          name: display_name || \"Spotify User\",\n        });\n\n        const { token, username, userId } = moodifyRes.data;\n        localStorage.setItem(\"token\", token);\n        localStorage.setItem(\"username\", username);\n        localStorage.setItem(\"user_id\", userId);\n\n        navigate(\"/home\");\n      } catch (err) {\n        console.error(\"Authentication error:\", err.response?.data || err);\n        alert(\"Spotify authentication failed.\");\n        navigate(\"/\");\n      }\n    };\n\n    exchangeToken();\n  }, [navigate]);\n\n  return <p style={{ textAlign: \"center\", color: \"green\" }}>Authenticating with Spotify...</p>;\n};\n\nexport default Callback;\n*/import React,{useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import axios from\"axios\";const Callback=()=>{const navigate=useNavigate();useEffect(()=>{const urlParams=new URLSearchParams(window.location.search);const code=urlParams.get(\"code\");const codeVerifier=localStorage.getItem(\"code_verifier\");if(!code||!codeVerifier){alert(\"Missing authorization code or verifier. Please try logging in again.\");return navigate(\"/\");}const exchangeToken=async()=>{try{const exchangeRes=await axios.post(\"https://moodify-i9qm.onrender.com/api/auth/exchange-token\",{code,code_verifier:codeVerifier});const{access_token,refresh_token,expires_in}=exchangeRes.data;const expiresAt=Date.now()+expires_in*1000;// ✅ Use consistent naming across frontend and backend\nlocalStorage.setItem(\"spotify_access_token\",access_token);localStorage.setItem(\"spotify_refresh_token\",refresh_token);localStorage.setItem(\"spotify_token_expires_at\",expiresAt.toString());console.log(\"✅ Spotify Access Token:\",access_token);// ✅ Fetch Spotify user profile\nconst profileRes=await fetch(\"https://api.spotify.com/v1/me\",{headers:{Authorization:`Bearer ${access_token}`}});const profile=await profileRes.json();const{email,display_name,id:spotifyUserId}=profile;localStorage.setItem(\"spotify_user_id\",spotifyUserId);// ✅ Login or register with Moodify backend\nconst moodifyRes=await axios.post(\"https://moodify-i9qm.onrender.com/api/auth/spotify-login\",{email,name:display_name||\"Spotify User\"});const{token,username,userId}=moodifyRes.data;localStorage.setItem(\"token\",token);localStorage.setItem(\"username\",username);localStorage.setItem(\"user_id\",userId);navigate(\"/home\");}catch(err){var _err$response;console.error(\"Authentication error:\",((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data)||err);alert(\"Spotify authentication failed.\");navigate(\"/\");}};exchangeToken();},[navigate]);return/*#__PURE__*/React.createElement(\"p\",{style:{textAlign:\"center\",color:\"green\"}},\"Authenticating with Spotify...\");};export default Callback;","map":{"version":3,"names":["React","useEffect","useNavigate","axios","Callback","navigate","urlParams","URLSearchParams","window","location","search","code","get","codeVerifier","localStorage","getItem","alert","exchangeToken","exchangeRes","post","code_verifier","access_token","refresh_token","expires_in","data","expiresAt","Date","now","setItem","toString","console","log","profileRes","fetch","headers","Authorization","profile","json","email","display_name","id","spotifyUserId","moodifyRes","name","token","username","userId","err","_err$response","error","response","createElement","style","textAlign","color"],"sources":["/Users/rutvikzalavadiya/Desktop/capstone-1/capstone/frontend-final/src/Callback.js"],"sourcesContent":["/* // src/components/Callback.js\nimport React, { useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\n\nconst Callback = () => {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const code = urlParams.get(\"code\");\n    const codeVerifier = localStorage.getItem(\"code_verifier\");\n\n    if (!code || !codeVerifier) {\n      alert(\"Missing authorization code or verifier. Please try logging in again.\");\n      return navigate(\"/\");\n    }\n\n    const exchangeToken = async () => {\n      try {\n        // Step 1: Exchange code + verifier for access token\n        const exchangeRes = await axios.post(\"https://moodify-i9qm.onrender.com/api/auth/exchange-token\", {\n          code,\n          code_verifier: codeVerifier\n        });\n\n        const { access_token, refresh_token } = exchangeRes.data;\nlocalStorage.setItem(\"spotify_token\", access_token);\nlocalStorage.setItem(\"spotify_refresh_token\", refresh_token);\nconst expiresIn = exchangeRes.data.expires_in; // seconds\nconst expiresAt = Date.now() + expiresIn * 1000; // milliseconds\nlocalStorage.setItem(\"spotify_token_expires_at\", expiresAt.toString());\n\n\n        console.log(\"✅ Spotify Access Token:\", access_token);\n\n\n        // Step 2: Get user profile from Spotify\n        const profileRes = await fetch(\"https://api.spotify.com/v1/me\", {\n          headers: {\n            Authorization: `Bearer ${access_token}`,\n          },\n        });\n\n        const profile = await profileRes.json();\n        const { email, display_name, id: spotifyUserId } = profile;\n        localStorage.setItem(\"spotify_user_id\", spotifyUserId);\n\n        // Step 3: Log in/register in Moodify backend\n        const moodifyRes = await axios.post(\"https://moodify-i9qm.onrender.com/api/auth/spotify-login\", {\n          email,\n          name: display_name || \"Spotify User\",\n        });\n\n        const { token, username, userId } = moodifyRes.data;\n        localStorage.setItem(\"token\", token);\n        localStorage.setItem(\"username\", username);\n        localStorage.setItem(\"user_id\", userId);\n\n        navigate(\"/home\");\n      } catch (err) {\n        console.error(\"Authentication error:\", err.response?.data || err);\n        alert(\"Spotify authentication failed.\");\n        navigate(\"/\");\n      }\n    };\n\n    exchangeToken();\n  }, [navigate]);\n\n  return <p style={{ textAlign: \"center\", color: \"green\" }}>Authenticating with Spotify...</p>;\n};\n\nexport default Callback;\n*/\n\nimport React, { useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\n\nconst Callback = () => {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const code = urlParams.get(\"code\");\n    const codeVerifier = localStorage.getItem(\"code_verifier\");\n\n    if (!code || !codeVerifier) {\n      alert(\"Missing authorization code or verifier. Please try logging in again.\");\n      return navigate(\"/\");\n    }\n\n    const exchangeToken = async () => {\n      try {\n        const exchangeRes = await axios.post(\"https://moodify-i9qm.onrender.com/api/auth/exchange-token\", {\n          code,\n          code_verifier: codeVerifier\n        });\n\n        const { access_token, refresh_token, expires_in } = exchangeRes.data;\n        const expiresAt = Date.now() + expires_in * 1000;\n\n        // ✅ Use consistent naming across frontend and backend\n        localStorage.setItem(\"spotify_access_token\", access_token);\n        localStorage.setItem(\"spotify_refresh_token\", refresh_token);\n        localStorage.setItem(\"spotify_token_expires_at\", expiresAt.toString());\n\n        console.log(\"✅ Spotify Access Token:\", access_token);\n\n        // ✅ Fetch Spotify user profile\n        const profileRes = await fetch(\"https://api.spotify.com/v1/me\", {\n          headers: {\n            Authorization: `Bearer ${access_token}`,\n          },\n        });\n\n        const profile = await profileRes.json();\n        const { email, display_name, id: spotifyUserId } = profile;\n        localStorage.setItem(\"spotify_user_id\", spotifyUserId);\n\n        // ✅ Login or register with Moodify backend\n        const moodifyRes = await axios.post(\"https://moodify-i9qm.onrender.com/api/auth/spotify-login\", {\n          email,\n          name: display_name || \"Spotify User\",\n        });\n\n        const { token, username, userId } = moodifyRes.data;\n        localStorage.setItem(\"token\", token);\n        localStorage.setItem(\"username\", username);\n        localStorage.setItem(\"user_id\", userId);\n\n        navigate(\"/home\");\n      } catch (err) {\n        console.error(\"Authentication error:\", err.response?.data || err);\n        alert(\"Spotify authentication failed.\");\n        navigate(\"/\");\n      }\n    };\n\n    exchangeToken();\n  }, [navigate]);\n\n  return <p style={{ textAlign: \"center\", color: \"green\" }}>Authenticating with Spotify...</p>;\n};\n\nexport default Callback;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}