{"ast":null,"code":"// src/components/Callback.js\nimport React,{useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import axios from\"axios\";const Callback=()=>{const navigate=useNavigate();useEffect(()=>{const urlParams=new URLSearchParams(window.location.search);const code=urlParams.get(\"code\");const codeVerifier=localStorage.getItem(\"code_verifier\");if(!code||!codeVerifier){alert(\"Missing authorization code or verifier. Please try logging in again.\");return navigate(\"/\");}const exchangeToken=async()=>{try{// Step 1: Exchange code + verifier for access token\nconst exchangeRes=await axios.post(\"https://moodify-capstone-winter2025.onrender.com/api/auth/exchange-token\",{code,code_verifier:codeVerifier});const{access_token,refresh_token}=exchangeRes.data;localStorage.setItem(\"spotify_token\",access_token);localStorage.setItem(\"spotify_refresh_token\",refresh_token);const expiresIn=exchangeRes.data.expires_in;// seconds\nconst expiresAt=Date.now()+expiresIn*1000;// milliseconds\nlocalStorage.setItem(\"spotify_token_expires_at\",expiresAt.toString());console.log(\"✅ Spotify Access Token:\",access_token);// Step 2: Get user profile from Spotify\nconst profileRes=await fetch(\"https://api.spotify.com/v1/me\",{headers:{Authorization:`Bearer ${access_token}`}});const profile=await profileRes.json();const{email,display_name,id:spotifyUserId}=profile;localStorage.setItem(\"spotify_user_id\",spotifyUserId);// Step 3: Log in/register in Moodify backend\nconst moodifyRes=await axios.post(\"https://moodify-capstone-winter2025.onrender.com/api/auth/spotify-login\",{email,name:display_name||\"Spotify User\"});const{token,username,userId}=moodifyRes.data;localStorage.setItem(\"token\",token);localStorage.setItem(\"username\",username);localStorage.setItem(\"user_id\",userId);navigate(\"/home\");}catch(err){var _err$response;console.error(\"Authentication error:\",((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data)||err);alert(\"Spotify authentication failed.\");navigate(\"/\");}};exchangeToken();},[navigate]);return/*#__PURE__*/React.createElement(\"p\",{style:{textAlign:\"center\",color:\"green\"}},\"Authenticating with Spotify...\");};export default Callback;","map":{"version":3,"names":["React","useEffect","useNavigate","axios","Callback","navigate","urlParams","URLSearchParams","window","location","search","code","get","codeVerifier","localStorage","getItem","alert","exchangeToken","exchangeRes","post","code_verifier","access_token","refresh_token","data","setItem","expiresIn","expires_in","expiresAt","Date","now","toString","console","log","profileRes","fetch","headers","Authorization","profile","json","email","display_name","id","spotifyUserId","moodifyRes","name","token","username","userId","err","_err$response","error","response","createElement","style","textAlign","color"],"sources":["/Users/rutvikzalavadiya/Desktop/capstone-1/capstone/frontend-final/src/Callback.js"],"sourcesContent":["// src/components/Callback.js\nimport React, { useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\n\nconst Callback = () => {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const code = urlParams.get(\"code\");\n    const codeVerifier = localStorage.getItem(\"code_verifier\");\n\n    if (!code || !codeVerifier) {\n      alert(\"Missing authorization code or verifier. Please try logging in again.\");\n      return navigate(\"/\");\n    }\n\n    const exchangeToken = async () => {\n      try {\n        // Step 1: Exchange code + verifier for access token\n        const exchangeRes = await axios.post(\"https://moodify-capstone-winter2025.onrender.com/api/auth/exchange-token\", {\n          code,\n          code_verifier: codeVerifier\n        });\n\n        const { access_token, refresh_token } = exchangeRes.data;\nlocalStorage.setItem(\"spotify_token\", access_token);\nlocalStorage.setItem(\"spotify_refresh_token\", refresh_token);\nconst expiresIn = exchangeRes.data.expires_in; // seconds\nconst expiresAt = Date.now() + expiresIn * 1000; // milliseconds\nlocalStorage.setItem(\"spotify_token_expires_at\", expiresAt.toString());\n\n\n        console.log(\"✅ Spotify Access Token:\", access_token);\n\n\n        // Step 2: Get user profile from Spotify\n        const profileRes = await fetch(\"https://api.spotify.com/v1/me\", {\n          headers: {\n            Authorization: `Bearer ${access_token}`,\n          },\n        });\n\n        const profile = await profileRes.json();\n        const { email, display_name, id: spotifyUserId } = profile;\n        localStorage.setItem(\"spotify_user_id\", spotifyUserId);\n\n        // Step 3: Log in/register in Moodify backend\n        const moodifyRes = await axios.post(\"https://moodify-capstone-winter2025.onrender.com/api/auth/spotify-login\", {\n          email,\n          name: display_name || \"Spotify User\",\n        });\n\n        const { token, username, userId } = moodifyRes.data;\n        localStorage.setItem(\"token\", token);\n        localStorage.setItem(\"username\", username);\n        localStorage.setItem(\"user_id\", userId);\n\n        navigate(\"/home\");\n      } catch (err) {\n        console.error(\"Authentication error:\", err.response?.data || err);\n        alert(\"Spotify authentication failed.\");\n        navigate(\"/\");\n      }\n    };\n\n    exchangeToken();\n  }, [navigate]);\n\n  return <p style={{ textAlign: \"center\", color: \"green\" }}>Authenticating with Spotify...</p>;\n};\n\nexport default Callback;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}