(this["webpackJsonpmoodify-frontend"]=this["webpackJsonpmoodify-frontend"]||[]).push([[0],{14:function(e,t,a){e.exports=a(28)},22:function(e,t,a){},23:function(e,t,a){},28:function(e,t,a){"use strict";a.r(t);var o=a(0),r=a.n(o),n=a(13),l=a.n(n),i=(a(22),a(10)),s=a(3),c=a(29);a(23);var m=()=>{const[e,t]=Object(o.useState)(null),[a,n]=Object(o.useState)(null),[l,i]=Object(o.useState)(null);return Object(o.useEffect)(()=>{const e=localStorage.getItem("spotify_token");if(!e)return;const a=document.createElement("script");a.src="https://sdk.scdn.co/spotify-player.js",a.async=!0,document.body.appendChild(a),window.onSpotifyWebPlaybackSDKReady=()=>{const a=new window.Spotify.Player({name:"Moodify Player",getOAuthToken:t=>t(e),volume:.5});a.addListener("ready",e=>{let{device_id:t}=e;console.log("\u2705 Spotify player ready with device ID:",t),localStorage.setItem("device_id",t),n(t)}),a.addListener("initialization_error",e=>{let{message:t}=e;console.error("Initialization Error:",t),i(t)}),a.addListener("authentication_error",e=>{let{message:t}=e;console.error("Auth Error:",t),i(t)}),a.addListener("account_error",e=>{let{message:t}=e;console.error("Account Error:",t),i("This feature requires Spotify Premium.")}),a.addListener("playback_error",e=>{let{message:t}=e;console.error("Playback Error:",t),i(t)}),a.connect().then(e=>{e||(console.error("\u274c Player connection failed (likely no Premium)."),i("Spotify Web Playback only works with Premium accounts."))}),t(a)}},[]),r.a.createElement("div",{style:{padding:"10px",backgroundColor:"#222",color:"#fff"}},r.a.createElement("p",null,"\ud83c\udfb5 Spotify Web Playback Initialized"),l?r.a.createElement("p",{style:{color:"red"}},"\u26a0\ufe0f ",l):a?r.a.createElement("p",null,"Device ID: ",a):r.a.createElement("p",null,"Waiting for device ID..."))};var d=()=>{const[e,t]=Object(o.useState)(""),[a,n]=Object(o.useState)([]),[l,i]=Object(o.useState)(""),[s,d]=Object(o.useState)(""),[p,u]=Object(o.useState)(!1),[y,g]=Object(o.useState)(!1),[f,h]=Object(o.useState)([]),v=localStorage.getItem("username");Object(o.useEffect)(()=>{localStorage.getItem("spotify_token")||(alert("Spotify login failed. Please try again."),window.location.href="/")},[]);const S=async()=>{let e=localStorage.getItem("spotify_token");const t=localStorage.getItem("spotify_token_expires_at"),a=Date.now();return(!e||!t||a>=Number(t))&&(e=await async function(){const e=localStorage.getItem("spotify_refresh_token");try{const t=await c.a.post("https://moodify-i9qm.onrender.com/api/auth/refresh-token",{refresh_token:e}),{access_token:a}=t.data;return localStorage.setItem("spotify_token",a),a}catch(t){console.error("Failed to refresh token:",t),alert("Spotify session expired. Please log in again."),window.location.href="/"}}()),e},k=async e=>{if(e.trim())try{var t,a;const o=localStorage.getItem("token"),r=await S(),l=localStorage.getItem("user_id"),s={name:`Moodify - ${e.charAt(0).toUpperCase()+e.slice(1)} Vibes`,songs:[],mood:e,createdByVoice:!1,voiceCommand:"",userId:l};console.log("Sending payload to generate playlist:",s);const m=await c.a.post("https://moodify-i9qm.onrender.com/api/playlist/generate",s,{headers:{Authorization:"Bearer "+o,"x-spotify-token":r}});console.log("Playlist response:",m.data),n((null===(t=m.data)||void 0===t||null===(a=t.playlist)||void 0===a?void 0:a.songs)||[]),i("")}catch(l){var o,r;console.error("Error generating playlist:",l.response||l),i((null===(o=l.response)||void 0===o||null===(r=o.data)||void 0===r?void 0:r.error)||"Failed to generate playlist.")}else i("Please enter a mood first.")},E=async e=>{const t=localStorage.getItem("spotify_token"),a=localStorage.getItem("device_id");if(t&&a)try{await fetch("https://api.spotify.com/v1/me/player/play?device_id="+a,{method:"PUT",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},body:JSON.stringify({uris:[e]})})}catch(o){console.error("Error playing track:",o),alert("Playback failed. Make sure Spotify is open and logged in.")}else alert("Spotify is not connected.")};return r.a.createElement("div",{className:"container"},r.a.createElement(m,null),r.a.createElement("nav",{style:{background:"#1DB954",padding:"10px"}},r.a.createElement("a",{href:"/home",style:{color:"#fff",marginRight:"15px"}},"Home"),r.a.createElement("a",{href:"/recommendations",style:{color:"#fff",marginRight:"15px"}},"Recommendations"),r.a.createElement("a",{href:"/playlists",style:{color:"#fff"}},"My Playlists")),r.a.createElement("h1",null,"Welcome to Moodify!"),v&&r.a.createElement("h2",null,"Login with Spotify to start Moodify"," ",r.a.createElement("span",{role:"img","aria-label":"headphone"},"\ud83c\udfa7")),r.a.createElement("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("spotify_token"),localStorage.removeItem("user_id"),window.location.href="/login"}},"Logout"),r.a.createElement("div",null,r.a.createElement("h2",null,"Generate Playlist"),r.a.createElement("input",{type:"text",placeholder:"Enter your mood (e.g., happy, sad)",value:e,onChange:e=>t(e.target.value)}),r.a.createElement("button",{onClick:()=>k(e)},"Generate Playlist")),r.a.createElement("div",null,r.a.createElement("button",{onClick:()=>{try{const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return void i("Speech recognition is not supported in your browser.");const a=new e;a.lang="en-US",a.onstart=()=>u(!0),a.onresult=async e=>{const a=e.results[0][0].transcript;t(a);const o=await(async e=>e.trim())(a);o?k(o):i("Unable to determine mood. Try again.")},a.onerror=e=>{console.error("Speech recognition error:",e),i("Speech recognition error: "+e.error)},a.onend=()=>u(!1),a.start()}catch(e){console.error("Speech recognition failed:",e),i("Speech recognition not supported or blocked.")}},disabled:p},p?"Listening...":"Speak Your Mood")),r.a.createElement("h3",null,"Playlist:"),l&&r.a.createElement("p",null,l),r.a.createElement("ul",null,a.map((e,t)=>r.a.createElement("li",{key:t,style:{marginBottom:"12px",display:"flex",alignItems:"center"}},e.albumImage&&r.a.createElement("img",{src:e.albumImage,alt:"Album Cover",width:"50",height:"50",style:{borderRadius:"5px",marginRight:"10px"}}),r.a.createElement("div",{style:{flex:1}},r.a.createElement("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"#1DB954"}},e.name," ",r.a.createElement("span",{style:{color:"#555"}},"\u2013 ",e.artist)),e.spotify_uri&&r.a.createElement("div",null,r.a.createElement("button",{onClick:()=>E(e.spotify_uri),style:{marginTop:"5px"}},"\u25b6\ufe0f Play in Moodify")))))),a.length>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"text",placeholder:"Custom Playlist Name (optional)",value:s,onChange:e=>d(e.target.value),style:{marginTop:"10px",padding:"8px",width:"80%"}}),r.a.createElement("button",{onClick:()=>{try{const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return void i("Speech recognition is not supported in your browser.");const t=new e;t.lang="en-US",t.start(),t.onstart=()=>g(!0),t.onresult=e=>{const t=e.results[0][0].transcript;d(t)},t.onerror=e=>{console.error("Voice naming error:",e),i("Voice naming error: "+e.error)},t.onend=()=>g(!1)}catch(e){console.error("Voice naming failed:",e),i("Voice naming not supported or blocked.")}},disabled:y,style:{marginLeft:"10px",padding:"8px"}},"\ud83c\udfa4 ",y?"Listening...":"Name by Voice"),r.a.createElement("br",null),r.a.createElement("button",{onClick:async()=>{const t=localStorage.getItem("token"),o=localStorage.getItem("user_id");if(a.length)try{await c.a.post("https://moodify-i9qm.onrender.com/api/playlist/save",{name:s,songs:a,mood:e,userId:o},{headers:{Authorization:"Bearer "+t}}),alert("Playlist saved successfully!"),d("")}catch(r){console.error("Failed to save playlist:",r),alert("Failed to save playlist.")}else alert("Please generate a playlist first.")},style:{marginTop:"10px"}},r.a.createElement("span",{role:"img","aria-label":"save"},"\ud83d\udcbe")," ","Save this Playlist"),r.a.createElement("br",null),r.a.createElement("button",{onClick:async()=>{const e=localStorage.getItem("spotify_token"),t=localStorage.getItem("spotify_user_id");if(!s||0===a.length)return void alert("Please generate and name a playlist first.");console.log("\ud83c\udfb5 Playlist being sent to Spotify:",a);const o=a.map(e=>{var t;const a=null===(t=e.url)||void 0===t?void 0:t.match(/track\/([a-zA-Z0-9]+)/);return a?"spotify:track:"+a[1]:null}).filter(Boolean);if(console.log("\ud83c\udfaf Extracted URIs:",o),0!==o.length)try{var r;const a=await fetch(`https://api.spotify.com/v1/users/${t}/playlists`,{method:"POST",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"},body:JSON.stringify({name:s,description:"Created with Moodify \ud83c\udfb5",public:!1})}),n=await a.json();if(!a.ok||!n.id)return console.error("Spotify playlist creation failed:",n),void alert("Spotify playlist creation failed.");await fetch(`https://api.spotify.com/v1/playlists/${n.id}/tracks`,{method:"POST",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"},body:JSON.stringify({uris:o})}),alert("\u2705 Playlist saved to your Spotify account!"),window.open((null===(r=n.external_urls)||void 0===r?void 0:r.spotify)||"https://open.spotify.com","_blank")}catch(n){console.error("\u274c Failed to sync to Spotify:",n),alert("Failed to save playlist to Spotify.")}else alert("No valid tracks to add. Please regenerate playlist.")},style:{marginTop:"10px"}},"\ud83d\udc9a Save to Spotify")),r.a.createElement("h3",null,"Recommended for You"),r.a.createElement("button",{onClick:async()=>{try{var e;const a=localStorage.getItem("spotify_token"),o=async(e,t)=>{const a=[];for(const o of e){const e=await fetch(`https://api.spotify.com/v1/recommendations?seed_tracks=${o}&limit=1`,{headers:{Authorization:"Bearer "+t}});if(e.ok){const t=await e.json();t.tracks&&t.tracks.length>0?a.push(o):console.warn("\u26a0\ufe0f No recommendations for seed track: "+o)}else console.warn(`\u274c Track not valid for recommendations: ${o} - Status ${e.status}`);if(a.length>=3)break}return a},r=await fetch("https://api.spotify.com/v1/me/top/tracks?limit=5",{headers:{Authorization:"Bearer "+a}}),n=await r.text();if(!r.ok)return console.error("\u274c Top tracks fetch failed:",r.status,n),void i("Failed to fetch top tracks.");let l;try{l=JSON.parse(n)}catch(t){return console.error("\u274c Failed to parse top tracks JSON:",t,n),void i("Error parsing top tracks from Spotify.")}const s=(null===(e=l.items)||void 0===e?void 0:e.map(e=>e.id))||[];if(console.log("\ud83c\udfaf Raw seed tracks:",s),0===s.length)return void i("No top tracks found. Please listen to more songs on Spotify.");const c=await o(s,a);if(console.log("\u2705 Valid recommendation seeds:",c),0===c.length)return void i("No valid tracks found for recommendations. Try listening to more music on Spotify.");const m=await fetch(`https://api.spotify.com/v1/recommendations?seed_tracks=${c.join(",")}&limit=10`,{headers:{Authorization:"Bearer "+a}}),d=await m.text();if(!m.ok)return console.error("\u274c Recommendations fetch failed:",m.status,d),void i("Failed to fetch recommendations.");let p;try{p=JSON.parse(d)}catch(t){return console.error("\u274c Failed to parse recommendations JSON:",t,d),void i("Error parsing recommendations from Spotify.")}console.log("\ud83c\udf81 Final Recommendations:",p),h(Array.isArray(p.tracks)?p.tracks.map(e=>{var t,a;return{name:e.name,artist:(null===(t=e.artists[0])||void 0===t?void 0:t.name)||"Unknown",albumImage:(null===(a=e.album.images[0])||void 0===a?void 0:a.url)||"",url:e.external_urls.spotify,spotify_uri:e.uri}}):[])}catch(a){console.error("\ud83d\udca5 Recommendation fetch failed:",a),i("Failed to fetch recommendations.")}}},r.a.createElement("span",{role:"img","aria-label":"target"},"\ud83c\udfaf")," ","Show Personalized Recommendations"),r.a.createElement("ul",null,f.map((e,t)=>r.a.createElement("li",{key:t,style:{marginBottom:"12px",display:"flex",alignItems:"center"}},e.albumImage&&r.a.createElement("img",{src:e.albumImage,alt:"Album Cover",width:"50",height:"50",style:{borderRadius:"5px",marginRight:"10px"}}),r.a.createElement("div",{style:{flex:1}},r.a.createElement("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"#1DB954"}},e.name," ",r.a.createElement("span",{style:{color:"#555"}},"\u2013 ",e.artist)),e.spotify_uri&&r.a.createElement("div",null,r.a.createElement("button",{onClick:()=>E(e.spotify_uri),style:{marginTop:"5px"}},r.a.createElement("span",{role:"img","aria-label":"target"},"\u25b6\ufe0f")," ","Play in Moodify")))))))};var p=e=>{let{onMoodDetected:t}=e;const[a,n]=Object(o.useState)(!1);return r.a.createElement("div",null,r.a.createElement("button",{onClick:()=>{const e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.lang="en-US",e.interimResults=!1,e.start(),e.onstart=()=>n(!0),e.onend=()=>n(!1),e.onresult=e=>{const a=e.results[0][0].transcript;t(a)}},disabled:a},a?"Listening...":"Start Voice Command"))};var u=()=>{const e="localhost"===window.location.hostname?"http://localhost:3000/callback":"https://moodify-i9qm.onrender.com/callback",t=["user-read-email","user-read-private","user-top-read","user-read-playback-state","user-modify-playback-state","streaming","playlist-modify-public","playlist-modify-private"];return r.a.createElement("div",{style:{textAlign:"center",marginTop:"50px"}},r.a.createElement("h2",null,"Login with Spotify to start Moodify"," ",r.a.createElement("span",{role:"img","aria-label":"headphone"},"\ud83c\udfa7")),r.a.createElement("button",{style:{padding:"10px 20px",marginTop:"20px"},onClick:async()=>{const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let o=0;o<e;o++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}(),o=await(async e=>{const t=(new TextEncoder).encode(e),a=await window.crypto.subtle.digest("SHA-256",t);return btoa(String.fromCharCode(...new Uint8Array(a))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})(a);localStorage.setItem("code_verifier",a);const r=new URLSearchParams({response_type:"code",client_id:"cdea26e7b85149eeb1e02a6812690634",scope:t.join(" "),redirect_uri:e,code_challenge_method:"S256",code_challenge:o});window.location.href="https://accounts.spotify.com/authorize?"+r.toString()}},"Login with Spotify"))};var y=()=>{const e=Object(s.f)();return Object(o.useEffect)(()=>{const t=new URLSearchParams(window.location.search).get("code"),a=localStorage.getItem("code_verifier");if(!t||!a)return alert("Missing authorization code or verifier. Please try logging in again."),e("/");(async()=>{try{const o=await c.a.post("https://moodify-i9qm.onrender.com/api/auth/exchange-token",{code:t,code_verifier:a}),{access_token:r,refresh_token:n,expires_in:l}=o.data,i=Date.now()+1e3*l;localStorage.setItem("spotify_access_token",r),localStorage.setItem("spotify_refresh_token",n),localStorage.setItem("spotify_token_expires_at",i.toString()),console.log("\u2705 Spotify Access Token:",r);const s=await fetch("https://api.spotify.com/v1/me",{headers:{Authorization:"Bearer "+r}}),m=await s.json(),{email:d,display_name:p,id:u}=m;localStorage.setItem("spotify_user_id",u);const y=await c.a.post("https://moodify-i9qm.onrender.com/api/auth/spotify-login",{email:d,name:p||"Spotify User"}),{token:g,username:f,userId:h}=y.data;localStorage.setItem("token",g),localStorage.setItem("username",f),localStorage.setItem("user_id",h),e("/home")}catch(r){var o;console.error("\u274c Token exchange failed:",(null===(o=r.response)||void 0===o?void 0:o.data)||r.message),alert("Spotify authentication failed."),e("/")}})()},[e]),r.a.createElement("p",{style:{textAlign:"center",color:"green"}},"Authenticating with Spotify...")};var g=()=>{const[e,t]=Object(o.useState)([]),[a,n]=Object(o.useState)("");return Object(o.useEffect)(()=>{(async()=>{const e=localStorage.getItem("spotify_token");if(e)try{var a;const o=await fetch("https://api.spotify.com/v1/me/top/tracks?limit=5",{headers:{Authorization:"Bearer "+e}}),r=(null===(a=(await o.json()).items)||void 0===a?void 0:a.map(e=>e.id))||[];if(0===r.length)return void n("No top tracks found. Listen to more songs on Spotify.");const l=async t=>{const a=[];for(const r of t){var o;const t=await fetch(`https://api.spotify.com/v1/recommendations?seed_tracks=${r}&limit=1`,{headers:{Authorization:"Bearer "+e}}),n=await t.json();if(t.ok&&(null===(o=n.tracks)||void 0===o?void 0:o.length)>0&&a.push(r),a.length>=3)break}return a},i=await l(r);if(console.log("\u2705 Valid seeds:",i),0===i.length)return void n("No valid top tracks for generating recommendations. Try again later.");const s=await fetch(`https://api.spotify.com/v1/recommendations?seed_tracks=${i.join(",")}&limit=10`,{headers:{Authorization:"Bearer "+e}});if(!s.ok){const e=await s.text();return console.error("\u274c Recommendations failed:",e),void n("Failed to load recommendations. Spotify token might be expired.")}const c=await s.json();t(c.tracks||[]),c.tracks&&0!==c.tracks.length||n("No recommendations available at the moment.")}catch(o){console.error("\ud83d\udca5 Unexpected error:",o),n("Error loading recommendations. Try refreshing.")}else n("Please log in with Spotify first.")})()},[]),r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement("h2",null,"\ud83c\udfa7 Recommended For You"),a&&r.a.createElement("p",{style:{color:"red"}},a),r.a.createElement("ul",null,e.map(e=>{var t;return r.a.createElement("li",{key:e.id,style:{marginBottom:"10px"}},r.a.createElement("img",{src:null===(t=e.album.images[0])||void 0===t?void 0:t.url,alt:"cover",width:"50",style:{marginRight:"10px",verticalAlign:"middle"}}),r.a.createElement("a",{href:e.external_urls.spotify,target:"_blank",rel:"noreferrer",style:{textDecoration:"none",color:"#1DB954"}},e.name," - ",e.artists[0].name))})))};var f=()=>{const[e,t]=Object(o.useState)([]),[a,n]=Object(o.useState)(!0),l=localStorage.getItem("user_id"),i=localStorage.getItem("token");Object(o.useEffect)(()=>{l&&i&&(async()=>{try{const e=await c.a.get("https://moodify-i9qm.onrender.com/api/playlist/user/"+l,{headers:{Authorization:"Bearer "+i}});console.log("\ud83c\udfa7 Fetched playlists:",e.data),t(Array.isArray(e.data)?e.data:[])}catch(e){console.error("Error fetching user playlists:",e),t([])}finally{n(!1)}})()},[l,i]);return r.a.createElement("div",{className:"container"},r.a.createElement("h2",null,r.a.createElement("span",{role:"img","aria-label":"music"},"\ud83c\udfb5")," My Saved Playlists"),a?r.a.createElement("p",null,"Loading playlists..."):0===e.length?r.a.createElement("p",null,"No playlists found."):r.a.createElement(r.a.Fragment,null,e.map((a,o)=>r.a.createElement("div",{key:o,style:{marginBottom:"20px",borderBottom:"1px solid #ccc",paddingBottom:"10px"}},r.a.createElement("h3",null,a.name),r.a.createElement("p",null,r.a.createElement("strong",null,"Created:")," ",(e=>{const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()})(a.createdAt)),r.a.createElement("ul",null,Array.isArray(a.songs)&&a.songs.length>0?a.songs.map((e,t)=>r.a.createElement("li",{key:t},r.a.createElement("a",{href:e.url,target:"_blank",rel:"noopener noreferrer"},e.name," - ",e.artist))):r.a.createElement("li",null,"No songs in this playlist.")),r.a.createElement("button",{onClick:()=>(async a=>{try{await c.a.delete("https://moodify-i9qm.onrender.com/"+a,{headers:{Authorization:"Bearer "+i}}),t(e.filter(e=>e._id!==a))}catch(o){console.error("Failed to delete playlist:",o)}})(a._id),style:{backgroundColor:"#dc3545",color:"#fff",padding:"5px 10px",border:"none"}},r.a.createElement("span",{role:"img","aria-label":"delete"},"\ud83d\uddd1\ufe0f")," Delete"))),r.a.createElement("button",{onClick:async()=>{if(window.confirm("Are you sure you want to delete all playlists?"))try{await c.a.delete(`https://moodify-i9qm.onrender.com/${l}/clear`,{headers:{Authorization:"Bearer "+i}}),t([])}catch(e){console.error("Failed to clear playlists:",e)}},style:{backgroundColor:"#dc3545",color:"#fff",padding:"8px 15px",border:"none",marginTop:"10px"}},r.a.createElement("span",{role:"img","aria-label":"clear"},"\u274c")," Clear All")))};var h=()=>r.a.createElement(i.a,null,r.a.createElement("div",null,r.a.createElement("h1",null,"Moodify: AI Playlist Generator"),r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/",element:r.a.createElement(u,null)}),r.a.createElement(s.a,{path:"/callback",element:r.a.createElement(y,null)}),r.a.createElement(s.a,{path:"/home",element:r.a.createElement(d,null)}),r.a.createElement(s.a,{path:"/voicecommand",element:r.a.createElement(p,null)}),r.a.createElement(s.a,{path:"/recommendations",element:r.a.createElement(g,null)}),r.a.createElement(s.a,{path:"/playlists",element:r.a.createElement(f,null)}))));var v=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,30)).then(t=>{let{getCLS:a,getFID:o,getFCP:r,getLCP:n,getTTFB:l}=t;a(e),o(e),r(e),n(e),l(e)})};l.a.createRoot(document.getElementById("root")).render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(h,null))),v()}},[[14,1,2]]]);
//# sourceMappingURL=main.549a998d.chunk.js.map